<div class="min-h-screen bg-gray-50 flex flex-col font-sans overflow-x-hidden">
  <nav class="bg-gray-900 text-white flex items-center justify-between px-6 py-3 shadow-md">
    <div class="flex items-center gap-10">
      <span class="font-black text-2xl tracking-tighter text-sky-500">ASSEMBLY</span>
      <div class="flex gap-8 text-sm font-medium">
        <a href="#" class="text-white border-b-2 border-sky-500 pb-1">Plenário</a>
      </div>
    </div>
  </nav>

  <div class="flex flex-1">
    <main class="flex-1 p-8">
      <div class="flex justify-between items-end mb-8">
        <div>
          <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight">Módulo de Plenário</h1>
        </div>
        <button (click)="abrirModalPauta()" 
                class="bg-emerald-600 hover:bg-sky-700 text-white px-5 py-2.5 rounded-lg flex items-center gap-2 font-bold shadow-sm transition-all active:scale-95">
          <span class="text-xl leading-none">+</span> Nova Pauta
        </button>
      </div>

      <div class="bg-white border border-gray-200 rounded-xl shadow-sm relative">
      <table class="w-full text-left text-sm">
        <thead class="bg-gray-50 border-b border-gray-200 text-gray-400 uppercase text-[10px] tracking-widest font-bold">
          <tr>
            <th class="px-6 py-4">Pauta</th>
            <th class="px-6 py-4">Descrição</th>
            <th class="px-6 py-4">Período da Sessão</th>
            <th class="px-6 py-4 text-center">Status</th>
            <th class="px-6 py-4 text-right">Ações</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          <tr *ngFor="let pauta of pautas; let i = index" class="hover:bg-gray-50/50 transition-colors">
            <td class="px-6 py-4 font-bold text-gray-800">{{ pauta.titulo }}</td>
            <td class="px-6 py-4 text-gray-500 max-w-md truncate">{{ pauta.descricao }}</td>
            <td class="px-6 py-4 text-gray-500 italic text-xs">
              {{ pauta.sessao ? (pauta.sessao.dataAbertura | date:'dd/mm/yy HH:mm') + ' - ' + (pauta.sessao.dataFechamento | date:'dd/mm/yy HH:mm') : 'Não iniciada' }}
            </td>
            <td class="px-6 py-4 text-center">
            <span [ngClass]="{
                'bg-emerald-100 text-emerald-700': pauta.status === 'ABERTA' || pauta.status === 'APROVADA',
                'bg-red-50 text-red-600': pauta.status === 'ENCERRADA' || pauta.status === 'REPROVADA',
                'bg-blue-50 text-blue-600': pauta.status === 'CRIADA',
                'bg-gray-100 text-gray-500': pauta.status === 'EMPATE'
              }" class="px-2.5 py-1 rounded-md text-[10px] font-black uppercase border border-transparent inline-block">
              {{ pauta.status }}
            </span>
            </td>

            <td class="px-6 py-4 text-right relative">
              <button (click)="toggleKebab(i, $event)" 
                      class="text-gray-400 hover:text-sky-600 p-2 rounded-lg hover:bg-sky-50 transition-all focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
                </svg>
              </button>
                <div *ngIf="kebabAberto === i" 
                    [ngClass]="i >= pautas.length - 2 ? 'bottom-0' : 'top-[20px]'"
                    class="absolute right-12 w-48 bg-white border border-gray-200 shadow-lg z-[1000] animate-in fade-in slide-in-from-right-1 duration-150">
                  
                  <button [disabled]="pauta.status !== 'CRIADA'" (click)="abrirModalSessao(pauta)"
                          class="w-full px-4 py-2.5 text-xs font-semibold text-gray-700 hover:bg-sky-50 hover:text-sky-700 flex items-center gap-3 disabled:opacity-30 disabled:cursor-not-allowed">
                    Abrir Sessão
                  </button>

                  <button [disabled]="pauta.status !== 'ABERTA'" (click)="abrirModalVoto(pauta)"
                          class="w-full px-4 py-2.5 text-xs font-semibold text-gray-700 hover:bg-sky-50 hover:text-sky-700 flex items-center gap-3 disabled:opacity-30 disabled:cursor-not-allowed border-t border-gray-50">
                    Registrar Voto
                  </button>

                  <button [disabled]="pauta.status !== 'ENCERRADA'" (click)="pauta.id && executarApuracao(pauta.id)" 
                          class="w-full px-4 py-2.5 text-xs font-semibold text-gray-700 hover:bg-sky-50 hover:text-sky-700 flex items-center gap-3 disabled:opacity-30 disabled:cursor-not-allowed border-t border-gray-50">
                    Apurar Votos
                  </button>

                  <button [disabled]="!['APROVADA', 'REPROVADA', 'EMPATE'].includes(pauta.status)" (click)="abrirModalResultados(pauta)" 
                          class="w-full px-4 py-2.5 text-xs font-semibold text-gray-700 hover:bg-sky-50 hover:text-sky-700 flex items-center gap-3 disabled:opacity-30 disabled:cursor-not-allowed border-t border-gray-50">
                    Ver Resultados
                  </button>
                </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    </main>
  </div>
</div>

<div *ngIf="modalPauta" class="fixed inset-0 z-[1001] flex items-center justify-center bg-gray-900 bg-opacity-60 backdrop-blur-sm p-4">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 border border-gray-200">
    
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-xl font-bold text-gray-800">Nova Pauta</h2>
      <button (click)="abrirModalPauta()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
    </div>

    <form (ngSubmit)="cadastrarPauta()" class="space-y-5">
      
      <div>
        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1 tracking-wider">Título da Pauta</label>
        <input [(ngModel)]="novaPauta.titulo" name="titulo" type="text" 
               placeholder="Ex: Assembleia Geral 2026"
               class="w-full border border-gray-300 rounded-md p-2.5 text-sm focus:ring-2 outline-none transition-all">
      </div>
      
      <div>
        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1 tracking-wider">Descrição Detalhada</label>
        <textarea [(ngModel)]="novaPauta.descricao" name="descricao" 
                  placeholder="Descreva os pontos principais desta pauta..."
                  class="w-full border border-gray-300 rounded-md p-2.5 text-sm h-32 focus:ring-2 outline-none transition-all resize-none"></textarea>
      </div>

      <div class="flex justify-end items-center gap-3 mt-8">
        <button (click)="abrirModalPauta()" type="button" 
                class="px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded transition-colors">
          Cancelar
        </button>
        <button type="submit" 
                [disabled]="!novaPauta.titulo"
                [class.opacity-50]="!novaPauta.titulo"
                class="bg-emerald-600 hover:bg-emerald-700 px-6 py-2 rounded text-white text-sm font-bold shadow-sm transition-colors uppercase tracking-wide">
          Salvar Pauta
        </button>
      </div>

    </form>
  </div>
</div>

<app-sessao-modal 
  *ngIf="exibirModalSessao" 
  [pauta]="pautaSelecionada"
  (fechar)="exibirModalSessao = false"
  (confirmar)="confirmarSessao($event)">
</app-sessao-modal>

<app-votos-modal 
  *ngIf="exibirModalVoto" 
  [pauta]="pautaSelecionada"
  (fechar)="exibirModalVoto = false"
  (confirmarVoto)="registrarVoto($event)">
</app-votos-modal>

<app-resultados-modal 
  *ngIf="exibirResultados" 
  [pauta]="pautaSelecionada" 
  (fechar)="exibirResultados = false">
</app-resultados-modal>

<app-toast></app-toast>